(function(b){var a=function(d,c){this.$input=b(d);this.options=c;this.init()};a.defaults={source:{},categories:{},paramName:"query",minChars:3};a.prototype.cacheData={};a.prototype.currentData={};a.prototype.selectedFilters={};a.prototype.init=function(){var c=this;c.$input.attr({autocomplete:"off"});c.$container=c.$input.wrap('<div class="select1"/>').parent();c.$container.on("click",function(){c.$input.focus()});c.$input.on("focus",function(){c.$filtersContainer.show()}).on("keydown",function(d){switch(d.keyCode||d.which){case 9:case 13:d.preventDefault();break;case 8:if(!this.value.length){c.clear(c.$container.find(".octofilter-label:last").data("value"))}break;case 27:c.$input.val("").blur();c.$filtersContainer.hide();break}}).on("keyup",function(d){switch(d.keyCode||d.which){case 9:case 13:var e=c.$filtersContainer.find(".octofilter-link.octofilter-active:first");if(e.length){c.select(e.data("value"))}break;default:if(this.value.length>=c.options.minChars){c.search(this.value)}else{c.search("")}}});c.search("",function(){c.$filtersContainer.on("click",".octofilter-link",function(d){d.preventDefault();d.stopPropagation();c.select(b(this).data("value"))});c.$container.on("click",".octofilter-clear",function(d){d.preventDefault();d.stopPropagation();console.log("SUPPRIMER START");c.clear(b(this).closest(".octofilter-label").data("value"))});b(document).on("click",function(f){var e=b(f.target),d=e.parents().add(e);if(d.index(c.$container)===-1&&d.index(c.$filtersContainer)===-1){c.$filtersContainer.hide()}})})};a.prototype.makeFilterContainer=function(){var c=this;if(!c.$filtersContainer){c.$filtersContainer=b('<div class="octofilter-container"><ul class="col-xs-4 col-sm-2 col-lg-2 nav"></ul><div class="col-xs-2 col-sm-2 col-lg-1 roler_search"></div><div class="col-xs-4 col-sm-4 col-lg-9 tab-content"></div></div>').insertAfter(c.$input)}var f=[];for(var e in c.options.categories){var d=c.options.categories[e];f.push('<li><a href="#octofilter-'+e+'" class="nav-'+e+'" data-toggle="tab">'+d+"</a></li>")}c.$filtersContainer.find(".nav").html(f).find("li:first").addClass("active")};a.prototype.populateFilterContainer=function(h){var m=this;h=b.extend({},h);if(b.isEmptyObject(m.options.categories)){b.each(h,function(n){m.options.categories[n]=n});m.makeFilterContainer()}var f=[],j=function(o){var n=o.name||o.value||o;return n.toLowerCase().indexOf(m.$input.val().toLowerCase())!==-1};m.currentData={};for(var c in m.options.categories){if(typeof h[c]==="string"){h[c]=b.parseJSON(h[c])}if(m.$input.val().length>=m.options.minChars){h[c]=b.grep(h[c],j)}var e=[];if(h[c].length){for(var l in h[c]){var i="octofilter-link",k=l.name||l.value||h[c][l];if(b.inArray(k,m.selectedFilters[c])!==-1){i+=" octofiltered"}e.push(b("<a/>",{text:k,"class":i,"data-category":c,"data-value":k}))}m.currentData[c]=h[c]}else{e.push(b("<span/>",{text:m.options.categories[c].toLowerCase()+" not found.","class":"octofilter-not-found"}))}f.push(b("<div/>",{id:"octofilter-"+c,"class":"tab-pane"}).html(e))}m.$filtersContainer.find(".tab-content").html(f);var d=m.$filtersContainer.find(".octofilter-link:not(.octofiltered):first");var g;if(d.length){g=d.closest(".tab-pane").addClass("active")}else{g=m.$filtersContainer.find(".tab-pane:first").addClass("active")}m.$filtersContainer.find('[href="#'+g.attr("id")+'"]').tab("show");if(m.$input.val().length>=m.options.minChars){d.addClass("octofilter-active")}};a.prototype.search=function(d,f){if(this.cacheData[d]){this.populateFilterContainer(this.cacheData[d]);if(typeof f==="function"){f()}this.$input.trigger("octofilter.search",[this.cacheData[d]])}else{if(typeof this.options.source==="string"){var c=this,e={};e[this.options.paramName]=d;b.getJSON(this.options.source,e,function(g){c.cacheData[d]=g;if(!c.$filtersContainer){c.makeFilterContainer()}c.populateFilterContainer(g);if(typeof f==="function"){f()}c.$input.trigger("octofilter.search",[g])})}else{if(!this.$filtersContainer){this.makeFilterContainer()}this.populateFilterContainer(this.options.source);if(typeof f==="function"){f()}this.$input.trigger("octofilter.search",[this.currentData])}}};a.prototype.select=function(g){var d=this,h=d.$filtersContainer.find('.octofilter-link[data-value="'+g+'"]'),e=h.data("category");if(b.inArray(g,d.selectedFilters[e])!==-1){d.$input.focus();return}if(!d.selectedFilters[e]){d.selectedFilters[e]=[]}d.selectedFilters[e].push(g);var c=b("<span/>",{"class":"octofilter-label",text:h.text(),"data-value":g,"data-category":e});b("<a/>",{"class":"octofilter-clear",html:"&times;"}).appendTo(c);var f=d.$container.find(".octofilter-label");if(f.length){f.last().after(c)}else{d.$container.prepend(c)}d.$input.val("").focus();d.search("");d.$input.trigger("octofilter.select",[d.selectedFilters])};a.prototype.clear=function(g){var e=this,d={};if(!g){e.$container.find(".octofilter-label").remove();e.selectedFilters={};e.$input.val("")}else{var c=e.$container.find('.octofilter-label[data-value="'+g+'"]').remove(),f=c.data("category");d[f]=e.selectedFilters[f].splice(e.selectedFilters[f].indexOf(g),2)}e.$input.focus();e.search(e.$input.val());e.$input.trigger("octofilter.clear",[d])};b.fn.octofilter=function(c){return this.each(function(){var f=b(this),e=f.data("octofilter"),d=b.extend({},a.defaults,f.data(),typeof c==="object"&&c);if(!e){f.data("octofilter",new a(this,d))}if(typeof c==="string"){e[c]()}})};b.fn.octofilter.Constructor=a})(window.jQuery);